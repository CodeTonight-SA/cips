{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "violations-registry.json",
  "description": "Unified violations registry - merges patterns.json with EFFICIENCY_CHECKLIST.md cross-references",
  "version": "1.0.0",
  "lastUpdated": "2025-11-27",

  "violations": {
    "repeated-file-reads": {
      "name": "Repeated File Reads",
      "description": "Reading same file multiple times without user edits",
      "regex": "(Read tool|Read\\(|read file).*\\b(package\\.json|tsconfig\\.json|CLAUDE\\.md|SKILL\\.md)\\b",
      "threshold": 3,
      "severity": "major",
      "points": 10,
      "impact": "500-2000 tokens wasted per occurrence",
      "remediation": {
        "quick": "Check conversation buffer before Read. Trust mental model after first read.",
        "detailed": "See CLAUDE.md Rule 1: File Read Optimization Protocol"
      },
      "checklist_reference": {
        "rule": "Rule 1: File Read Optimization",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "31-52",
        "anchor": "#rule-1-file-read-optimization"
      },
      "skill_suggestion": "file-read-optimizer",
      "agent_suggestion": "file-read-optimizer-agent",
      "examples": {
        "bad": "Re-reading `package.json` to check dependencies already cached",
        "good": "Single batch read of all relevant files upfront, trust buffer memory"
      }
    },

    "temp-script-creation": {
      "name": "Temporary Script Creation",
      "description": "Creating temporary scripts for simple batch operations",
      "regex": "(Write|create|creating).*\\.(js|py|sh)\\b.*(temp|tmp|script|extract|transform)",
      "threshold": 2,
      "severity": "major",
      "points": 10,
      "impact": "3000-8000 tokens vs 500 direct",
      "remediation": {
        "quick": "Use MultiEdit or single CLI command (rg | xargs sed) instead",
        "detailed": "See CLAUDE.md Rule 3: Implementation Directness Protocol"
      },
      "checklist_reference": {
        "rule": "Rule 3: Implementation Directness",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "77-99",
        "anchor": "#rule-3-implementation-directness"
      },
      "skill_suggestion": "direct-implementation-enforcer",
      "agent_suggestion": "direct-implementation-agent",
      "examples": {
        "bad": "Creating script to transform data instead of inline",
        "good": "MultiEdit for 6 similar file changes"
      }
    },

    "node-modules-read": {
      "name": "Dependency Folder Read",
      "description": "Reading from node_modules or dependency folders",
      "regex": "\\b(node_modules|venv|\\.venv|dist|build|__pycache__|target|vendor)\\b",
      "threshold": 1,
      "severity": "critical",
      "points": 50,
      "impact": "50000+ tokens wasted",
      "remediation": {
        "quick": "Always use --glob '!node_modules/*' --exclude venv flags",
        "detailed": "See CLAUDE.md PARAMOUNT RULE: Never Read Dependency/Build Folders"
      },
      "checklist_reference": {
        "rule": "PARAMOUNT RULE",
        "file": "CLAUDE.md",
        "line_range": "15-35",
        "anchor": "#paramount-rule-never-read-dependencybuild-folders"
      },
      "skill_suggestion": "dependency-guardian",
      "agent_suggestion": "dependency-guardian-agent",
      "auto_block": true,
      "examples": {
        "bad": "Reading node_modules/ accidentally: ~50000+ tokens",
        "good": "rg 'pattern' --glob '!node_modules/*' --glob '!venv/*'"
      }
    },

    "individual-edits": {
      "name": "Individual File Edits",
      "description": "Multiple individual Edit calls instead of batch MultiEdit",
      "regex": "Edit\\(|Edit tool",
      "threshold": 6,
      "severity": "major",
      "points": 10,
      "impact": "500 per file vs 800 batch",
      "remediation": {
        "quick": "Use MultiEdit for 3+ related file changes",
        "detailed": "See CLAUDE.md Rule 3: Implementation Directness Protocol"
      },
      "checklist_reference": {
        "rule": "Rule 3: Implementation Directness",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "77-99",
        "anchor": "#rule-3-implementation-directness"
      },
      "skill_suggestion": "batch-edit-enforcer",
      "agent_suggestion": null,
      "examples": {
        "bad": "Individual file edits instead of MultiEdit batch",
        "good": "MultiEdit [component1, component2, component3, component4, component5, component6]"
      }
    },

    "unnecessary-preambles": {
      "name": "Unnecessary Preambles",
      "description": "Starting responses with 'I'll now' or 'Let me'",
      "regex": "(I'll now|I will now|Let me|I'm going to|First, I'll)",
      "threshold": 5,
      "severity": "minor",
      "points": 3,
      "impact": "50-200 tokens per instance",
      "remediation": {
        "quick": "Start with action, skip announcements",
        "detailed": "See CLAUDE.md Rule 4: Concise by Default"
      },
      "checklist_reference": {
        "rule": "Rule 4: Concise Communication",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "100-122",
        "anchor": "#rule-4-concise-communication"
      },
      "skill_suggestion": "concise-communication",
      "agent_suggestion": null,
      "examples": {
        "bad": "'I'll now proceed to...' before every action",
        "good": "Direct execution without announcement"
      }
    },

    "unnecessary-postambles": {
      "name": "Unnecessary Postambles",
      "description": "Ending responses with summaries of what was just done",
      "regex": "(In summary|To summarize|I have completed|I've finished|Done\\.|Successfully completed)",
      "threshold": 5,
      "severity": "minor",
      "points": 3,
      "impact": "100-300 tokens per instance",
      "remediation": {
        "quick": "End when action completes, no summary needed",
        "detailed": "See CLAUDE.md Rule 4: Concise by Default"
      },
      "checklist_reference": {
        "rule": "Rule 4: Concise Communication",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "100-122",
        "anchor": "#rule-4-concise-communication"
      },
      "skill_suggestion": "concise-communication",
      "agent_suggestion": null,
      "examples": {
        "bad": "Summarizing what was just done",
        "good": "Ending when done"
      }
    },

    "grep-instead-of-rg": {
      "name": "grep Instead of rg",
      "description": "Using grep instead of ripgrep (rg)",
      "regex": "\\bgrep\\b(?!.*rg)",
      "threshold": 2,
      "severity": "minor",
      "points": 5,
      "impact": "Slower, may miss exclusions",
      "remediation": {
        "quick": "Always use rg with proper --glob exclusions",
        "detailed": "See CLAUDE.md Core Bash Tools section"
      },
      "checklist_reference": {
        "rule": "Core Bash Tools Violations",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "325-349",
        "anchor": "#core-bash-tools-violations"
      },
      "skill_suggestion": "bash-tool-enforcer",
      "agent_suggestion": null,
      "examples": {
        "bad": "Using `grep -r` instead of `rg`",
        "good": "`rg -l 'pattern' | xargs sed` for bulk changes"
      }
    },

    "find-instead-of-fd": {
      "name": "find Instead of fd",
      "description": "Using find instead of fd",
      "regex": "\\bfind\\b(?!.*fd)",
      "threshold": 2,
      "severity": "minor",
      "points": 5,
      "impact": "Slower, verbose syntax",
      "remediation": {
        "quick": "Always use fd with --exclude flags",
        "detailed": "See CLAUDE.md Core Bash Tools section"
      },
      "checklist_reference": {
        "rule": "Core Bash Tools Violations",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "325-349",
        "anchor": "#core-bash-tools-violations"
      },
      "skill_suggestion": "bash-tool-enforcer",
      "agent_suggestion": null,
      "examples": {
        "bad": "Using `find` instead of `fd`",
        "good": "`fd -e js` for finding JavaScript files"
      }
    },

    "unnecessary-plan-execution": {
      "name": "Unnecessary Plan Execution",
      "description": "Executing plan items that don't improve code",
      "regex": "(extract|refactor|create interface|modularize).*(?=already|exists|optimal)",
      "threshold": 2,
      "severity": "major",
      "points": 10,
      "impact": "5000-10000 tokens wasted",
      "remediation": {
        "quick": "Evaluate plan items before execution, propose skip if code satisfies",
        "detailed": "See CLAUDE.md Rule 2: Plan Item Evaluation Gate"
      },
      "checklist_reference": {
        "rule": "Rule 2: Plan Item Evaluation Gate",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "54-76",
        "anchor": "#rule-2-plan-item-evaluation-gate"
      },
      "skill_suggestion": "plan-evaluation-gate",
      "agent_suggestion": null,
      "examples": {
        "bad": "Extracting sections when code already modular",
        "good": "Skipping unnecessary extraction, verifying need before execution"
      }
    },

    "multi-tool-instead-of-cli": {
      "name": "Multiple Tools Instead of CLI",
      "description": "Multiple tool calls when single CLI command suffices",
      "regex": "(Read.*){3,}|(?:Edit.*){3,}",
      "threshold": 2,
      "severity": "major",
      "points": 10,
      "impact": "1000-3000 tokens saved with CLI",
      "remediation": {
        "quick": "Use rg | xargs sed, fd | xargs, or similar bulk operations",
        "detailed": "See CLAUDE.md Performance Rule: Single CLI > Multiple Tools"
      },
      "checklist_reference": {
        "rule": "Rule 3: Implementation Directness",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "77-99",
        "anchor": "#rule-3-implementation-directness"
      },
      "skill_suggestion": "cli-bulk-operations",
      "agent_suggestion": "direct-implementation-agent",
      "examples": {
        "bad": "Multiple Read calls instead of `rg | xargs`",
        "good": "`rg -l 'pattern' | xargs sed` for bulk changes"
      }
    },

    "arbitrary-line-count-filtering": {
      "name": "Arbitrary Line Count Filtering",
      "description": "Using arbitrary line counts instead of timestamp-based filtering",
      "regex": "(tail -n \\d+|head -n \\d+).*history\\.jsonl(?!.*timestamp)",
      "threshold": 2,
      "severity": "minor",
      "points": 5,
      "impact": "Imprecise temporal windows, potential stale data analysis",
      "remediation": {
        "quick": "Use tail + jq timestamp filtering",
        "detailed": "See lib/path-resolver.sh for proper timestamp-based filtering"
      },
      "checklist_reference": {
        "rule": "History Analysis",
        "file": "CLAUDE.md",
        "line_range": null,
        "anchor": "#chat-history-search"
      },
      "skill_suggestion": "timestamp-based-analysis",
      "agent_suggestion": "history-mining-agent",
      "examples": {
        "bad": "tail -n 500 history.jsonl",
        "good": "aggregate_project_history 24  # Last 24 hours"
      }
    },

    "context-loss": {
      "name": "Context Loss",
      "description": "Re-reading project docs within same session indicates missing context refresh",
      "regex": "Read\\((CLAUDE\\.md|README\\.md)\\).*Read\\(\\1\\)|read (CLAUDE\\.md|README\\.md).*read \\1",
      "threshold": 2,
      "severity": "major",
      "points": 10,
      "impact": "2000-5000 tokens wasted on repeated context establishment",
      "remediation": {
        "quick": "Use /refresh-context at session start",
        "detailed": "See context-refresh skill for 7-step protocol"
      },
      "checklist_reference": {
        "rule": "Session Start",
        "file": "CLAUDE.md",
        "line_range": null,
        "anchor": "#session-start-protocol"
      },
      "skill_suggestion": "context-refresh",
      "agent_suggestion": "context-refresh-agent",
      "examples": {
        "bad": "Reading CLAUDE.md multiple times in session",
        "good": "Run /refresh-context at session start, cache in mental model"
      }
    },

    "premature-feature-building": {
      "name": "Premature Feature Building",
      "description": "Implementing features before they are actually needed or requested",
      "regex": "(build|implement|add).*feature.*(future|might|maybe|just in case|when we need)",
      "threshold": 2,
      "severity": "major",
      "points": 10,
      "impact": "2000-10000 tokens wasted on speculative code",
      "remediation": {
        "quick": "Apply YAGNI: only build features when actually needed",
        "detailed": "See yagni-principle skill for decision framework"
      },
      "checklist_reference": {
        "rule": "Rule 5: YAGNI (Feature Necessity)",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "123-172",
        "anchor": "#rule-5-yagni-feature-necessity"
      },
      "skill_suggestion": "yagni-principle",
      "agent_suggestion": "yagni-enforcer-agent",
      "examples": {
        "bad": "Adding OAuth when only email/password needed",
        "good": "Building only what current requirements demand"
      }
    },

    "speculative-abstraction": {
      "name": "Speculative Abstraction",
      "description": "Creating abstractions for hypothetical future use cases",
      "regex": "(interface|abstract|generic).*\\b(future|potential|might|in case|when we)",
      "threshold": 2,
      "severity": "major",
      "points": 10,
      "impact": "3000-8000 tokens on unused abstractions",
      "remediation": {
        "quick": "Add abstractions when 2nd implementation exists, not 'just in case'",
        "detailed": "Apply YAGNI + DRY Rule of Three"
      },
      "checklist_reference": {
        "rule": "Rule 5: YAGNI (Feature Necessity)",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "123-172",
        "anchor": "#rule-5-yagni-feature-necessity"
      },
      "skill_suggestion": "yagni-principle",
      "agent_suggestion": "yagni-enforcer-agent",
      "examples": {
        "bad": "Creating interface with single implementation",
        "good": "Deferring features until user story exists"
      }
    },

    "unused-configuration": {
      "name": "Unused Configuration",
      "description": "Adding configuration options for features that don't exist yet",
      "regex": "(config|setting|feature.?flag|option).*\\b(todo|future|planned|upcoming|not.*implement)",
      "threshold": 3,
      "severity": "minor",
      "points": 5,
      "impact": "500-2000 tokens maintaining dead config",
      "remediation": {
        "quick": "Only add config for features that currently exist",
        "detailed": "Remove config when feature removed"
      },
      "checklist_reference": {
        "rule": "Rule 5: YAGNI (Feature Necessity)",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "123-172",
        "anchor": "#rule-5-yagni-feature-necessity"
      },
      "skill_suggestion": "yagni-principle",
      "agent_suggestion": null,
      "examples": {
        "bad": "Building feature flags for non-existent features",
        "good": "Config only for existing features"
      }
    },

    "markdown-violations": {
      "name": "Markdown Linting Violations",
      "description": "Markdown formatting issues that cause re-work",
      "regex": "(MD040|MD036|MD022|MD031|MD032|MD012|MD013|MD024)",
      "threshold": 3,
      "severity": "minor",
      "points": 5,
      "impact": "1000-3000 tokens wasted per documentation update",
      "remediation": {
        "quick": "Use /markdown-lint command to auto-fix",
        "detailed": "See EFFICIENCY_CHECKLIST.md Rule 6: Markdown Linting Standards"
      },
      "checklist_reference": {
        "rule": "Rule 6: Markdown Linting Standards",
        "file": "EFFICIENCY_CHECKLIST.md",
        "line_range": "173-324",
        "anchor": "#rule-6-markdown-linting-standards"
      },
      "skill_suggestion": "markdown-expert",
      "agent_suggestion": "markdown-expert-agent",
      "auto_fix_available": true,
      "examples": {
        "bad": "Code block without language tag",
        "good": "```bash instead of just ```"
      }
    }
  },

  "severity_levels": {
    "critical": {
      "points": 50,
      "description": "Must be fixed immediately, blocks workflow",
      "color": "red",
      "auto_block": true
    },
    "major": {
      "points": 10,
      "description": "Significant token waste, should be addressed",
      "color": "orange",
      "auto_block": false
    },
    "minor": {
      "points": 3,
      "description": "Small inefficiency, address when convenient",
      "color": "yellow",
      "auto_block": false
    }
  },

  "scoring": {
    "perfect": {"min": 0, "max": 0, "grade": "A+", "description": "No violations"},
    "excellent": {"min": 1, "max": 5, "grade": "A", "description": "Minor issues only"},
    "good": {"min": 6, "max": 15, "grade": "B", "description": "1-2 minor violations"},
    "needs_improvement": {"min": 16, "max": 30, "grade": "C", "description": "3-5 violations"},
    "critical": {"min": 31, "max": 999, "grade": "F", "description": "6+ violations or any critical"}
  },

  "meta": {
    "total_patterns": 16,
    "critical_count": 1,
    "major_count": 9,
    "minor_count": 6,
    "max_possible_points": 161,
    "generated_from": ["patterns.json", "EFFICIENCY_CHECKLIST.md"],
    "cross_references": true
  }
}
